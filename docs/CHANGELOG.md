# 📝 近期变更记录

> 从 DEVELOPMENT.md 拆分，记录各版本的变更和待处理事项。

## v1.5.18（2026-02-28）— 图鉴新增 +1 辅助包收集进度
- **辅助包集成到图鉴**：收集一览弹窗中，主卡池卡片下方新增「📦 +1 辅助包」区域
- 辅助包区域包含独立的收集进度条（可展开查看各稀有度详情）、稀有度分布标签、卡片网格
- 辅助包卡片支持已拥有/未拥有区分（与主卡池一致的灰度+🔒图标效果）
- 点击辅助包卡片可放大查看卡图
- `showCardPreview` 中增加辅助包数据注入（`supplementPack`），确保从卡包列表直接预览时也能加载辅助包数据
- `renderCardPreview` 新增第四个参数 `supplementCards`，排序切换时保持辅助包数据引用
- 新增 CSS 样式：`.supplement-section`（虚线分隔）、`.supplement-section-header`（琥珀橙金标题）

## v1.5.17（2026-02-28）— 移除非补充包的数字别名
- 移除 26PP、CH02、25DB、LOCH 的 packNumber 字段
- 数字别名（如1304）仅补充包（booster）使用，代表期数+弹数
- 其他分类卡包仅显示 packCode（如 CH02、26PP）

## v1.5.16（2026-02-28）— 解锁 LOCH + 新增「近期发售」标签页
- **解锁卡包**：LOCH（界限超越典藏包 －主角篇－）从锁定状态改为可开包状态
- **新增「近期发售」标签页**：作为默认标签页，进入主界面时首先展示
  - 显示所有未锁定的卡包，按发售日期从新到旧排序
  - 已锁定的卡包不会出现在该标签页中
- 标签页顺序：近期发售 > 补充包 > 主题卡组 > 系列补充包 > 特殊包
- `currentPackCategory` 默认值从 `'booster'` 改为 `'recent'`
- `renderPackList()` 新增 `recent` 分类的特殊筛选逻辑

## v1.5.15（2026-02-28）— 新增 LOCH 卡包（界限超越典藏包 －主角篇－）
- **新增卡包**：`LIMIT OVER COLLECTION - THE HEROES -`（LOCH），归类为特殊包（`category: "special"`），当前为锁定状态
- 中文名：界限超越典藏包 －主角篇－，发售日：2026-02-28，含税价格：385日元/包
- 封面图来源：KONAMI 官网（`cg2069-pack.png`）
- 创建占位卡牌文件 `data/ocg/cards/ocg_loch.json`，卡片收录和开包概率待后续配置
- **注意**：LOCH 的开包规则与普通补充包（如 BLZD）不同，`packScheme` 和概率参数待专门配置

## v1.5.14（2026-02-28）— 卡包页面显示优化 + 开包排序修复
- **卡包选择页**：第一行改为中文名（如"炽热支配"），第二行为英文缩写+数字编号（如"BLZD（1304）"），第三行独立显示发售日期；金币价格显示在中文名上方，两者之间有间距
- **卡包详情页**：标题区域改为三行显示——第一行"炽热支配·BLZD（1304）"，第二行日文名（小字），第三行英文名（小字）
- **packs.json 新增字段**：`packNameCN`（中文名）和 `packNumber`（数字编号），用于各页面显示
- **开包结果排序修复**：`showResults` 函数中的 `RARITY_RANK` 映射同步修正（SER=6, UTR=5），与稀有度统计排序一致
- **稀有度配色方案**：采用渐进式过渡配色，减少视觉割裂感

## v1.5.5（2026-02-28）— NR 卡归池修正：NR 属于 N 卡卡池
- **NR 卡归属修正**：NR 卡（JP028/JP070/JP080）的 `rarityCode` 改为 `"N"`，回到 N 卡卡池
- NR 卡的选中概率为普通 N 卡的 20%（通过加权随机实现，由 `nrWeightRatio` 配置控制）
- `rarityVersions` 保留 NR 标记（如 `["N", "NR", "PSER"]`），用于展示和背包系统识别
- **非 N 位不再产出 NR**：移除了旧的 "R 位 10% 变 NR" 逻辑（`boxNRChance` 已废弃）

## v1.5.4（2026-02-28）— 开包概率修正：NR卡归池 + 单包概率对齐盒规则
- **单包概率对齐**：`drawCards_OCG` 的非N位改为按 `boxRarityDistribution` 权重概率选择目标稀有度
- **NR卡归池修正**：NR卡不进任何卡池，只作为R位的10%概率变异产出

## v1.5.3（2026-02-28）— 开盒封入规则算法重构
- **整盒抽卡**：新增 `drawCardsBox_OCG` 函数，按真实封入规则分配30包的非N位稀有度（1SER+1UTR+3UR+6SR+19R）
- SER卡位有25%概率变为PSER（一箱24盒配6个原盒PSER）
- **辅助包PSER互斥**：同一盒中原盒包和+1辅助包合计只出现一张PSER

## v1.5.2（2026-02-27）— +1辅助包专属卡池 + 卡图放大修复
- 辅助包使用专属卡池（`supplementPack` 节点，BLZD-JPS01~JPS20 共 20 张卡）
- `api.js` 新增 `buildSupplementCardsFromLocalData` 函数
- 新增全局变量 `currentSupplementCards`

## v1.5.1（2026-02-27）— 新增「开整盒」（30包）选项
- 开包界面和结果界面新增「📦×30 开整盒」按钮
- 按钮采用紫金渐变 + 光效动画样式

## v1.5.0（2026-02-27）— 卡包锁定状态 UI
- 未开放的卡包以锁定状态展示，封面灰度 + 锁图标
- packs.json 新增 `locked` 字段

## v1.4.9（2026-02-27）— 开包界面新增收藏预览按钮

## v1.4.8（2026-02-27）— 卡包分类选项卡 + 新增 PREMIUM PACK 2026

## v1.4.7（2026-02-26）— 开包界面封面图可点击放大查看

## v1.4.6（2026-02-26）— 代码质量清理

## v1.4.5（2026-02-26）— 封面图加载优化

## v1.4.4（2026-02-26）— 开包界面 UI 优化

---

# ⏳ 待处理事项

> 以下是已确认但尚未完成的事项，请在后续开发中关注。

## 🟡 KONAMI 官方商品数据补全（进行中）
- 已完成：四个分类首页展示的商品信息采集（各 16 个，共 64 个商品），保存在 `pack_references/konami_official_products/` 下
- 待完成：各分类「もっと見る」（查看更多）内的早期商品数据录入
- 数据源：https://www.yugioh-card.com/japan/products/

## 🟡 OCG 稀有度问题
- BLZD 已完成真实数据录入，其他卡包（CH02、25DB）仍为测试稀有度
- 缓存同步：`api.js` 的 `getOCGCardSetData` 中已增加稀有度同步逻辑

## 🟢 多版本稀有度系统（已基本完成）
- 数据结构：`rarityVersions` 数组 + `rarityCode` 基础稀有度
- 8种稀有度 UI 完整支持
- **待用户确认**：`versionOdds` 各稀有度的实际概率权重

## 🔴 KONAMI 卡图代理无法获取真实卡图（挂起）
- 根本原因：KONAMI Imperva WAF 要求 JS 挑战验证，服务端代理无法通过
- 替代方案：使用 YGOProDeck / YGOCDB CDN（已集成）

## 🟢 图片资源自建 CDN 方案（后续规划）
- 当前使用第三方 CDN（YGOCDB / KONAMI / YugiohMeta），暂时够用
- 后续计划迁移到 Cloudflare R2 对象存储
- **触发时机**：活跃卡包超 10 个或第三方 CDN 不稳定时启动