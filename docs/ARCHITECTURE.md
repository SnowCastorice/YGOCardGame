# ğŸ“Š æ•°æ®æºæ¶æ„

> ä» DEVELOPMENT.md æ‹†åˆ†ï¼Œè¯¦è¿° OCG/TCG æ•°æ®è·å–æ–¹æ¡ˆã€æœåŠ¡ç«¯ä»£ç†å’Œæ–‡ä»¶ç»“æ„ã€‚

## OCG æ¨¡å¼ï¼ˆv1.4.0+ æœ¬åœ°æ•°æ®ä¼˜å…ˆï¼‰

> **é›¶ API è°ƒç”¨**ï¼šå¡ç‰Œæ•°æ®å†…åµŒåœ¨ JSON æ–‡ä»¶ä¸­ï¼ŒåŠ è½½å‡ ä¹ç¬æ—¶ã€‚

| ç»´åº¦ | æ¥æº | è¯´æ˜ |
|------|------|------|
| **å¡åŒ…åˆ—è¡¨** | `data/ocg/packs.json` | å¡åŒ…å…ƒä¿¡æ¯ç´¢å¼•ï¼ˆè½»é‡çº§ï¼‰ |
| **å¡ç‰Œæ”¶å½•** | `data/ocg/cards/*.json` | æ¯ä¸ªå¡åŒ…ç‹¬ç«‹æ–‡ä»¶ï¼Œå« cardIds + cardData |
| **å¡ç‰Œè¯¦æƒ…** | `cardData` èŠ‚ç‚¹ï¼ˆæœ¬åœ°ï¼‰ | ç”± `build_pack_data.py` ä» `cards.json` æå–æ³¨å…¥ |
| **ä¸­æ–‡å** | `cardData.cn_name`ï¼ˆæœ¬åœ°ï¼‰ | ä¸å†è°ƒç”¨ YGOCDB API |
| **å¡å›¾** | YGOCDB CDN (`cdn.233.momobako.com`) | æ—¥æ–‡ç‰ˆå¡å›¾ï¼ˆä»…å¡å›¾ä» CDN åŠ è½½ï¼‰ |
| **ç¨€æœ‰åº¦** | `cardIds[].rarityVersions` | æ‰‹åŠ¨é…ç½®åœ¨å¡åŒ…æ–‡ä»¶ä¸­ï¼Œå®šä¹‰å‚è§ `data/common/rarities.json` |
| **API å›é€€** | YGOProDeck + YGOCDB | ä»…å½“å¡åŒ…æœªæ„å»ºæœ¬åœ°æ•°æ®æ—¶æ‰è°ƒç”¨ |

**å·¥ä½œæµç¨‹**ï¼š
```
é¡µé¢åŠ è½½ packs.jsonï¼ˆè½»é‡ç´¢å¼•ï¼‰
    â†“
ç”¨æˆ·ç‚¹å‡»å¡åŒ… â†’ åŠ è½½ ocg_blzd.jsonï¼ˆå« cardData èŠ‚ç‚¹ï¼‰
    â†“
buildOCGCardsFromLocalData()ï¼ˆçº¯æœ¬åœ°è½¬æ¢ï¼‰
    â†“
ç›´æ¥å¼€åŒ…ï¼å¡å›¾ä» CDN åŠ è½½
```

## TCG æ¨¡å¼ï¼ˆæš‚åœå¼€å‘ï¼‰

> âš ï¸ TCG å¼€å‘å·²æš‚åœï¼Œå…¥å£é»˜è®¤éšè—ã€‚

| ç»´åº¦ | æ¥æº | è¯´æ˜ |
|------|------|------|
| **å¡åŒ…åˆ—è¡¨** | YGOCDB (`ygocdb.com/packs`) | åœ¨çº¿è·å– |
| **å¡ç‰Œæ”¶å½•** | YGOProDeck API (`?cardset=xxx`) | è‡ªåŠ¨è¿”å›å…¨éƒ¨å¡ç‰Œ + ç¨€æœ‰åº¦ |
| **å¡å›¾** | YugiohMeta S3 CDN + YGOProDeck CDN | è‹±æ–‡ç‰ˆå¡å›¾ |
| **ç¨€æœ‰åº¦** | YGOProDeck API | `card_sets.set_rarity` è‡ªåŠ¨æ˜ å°„ |

## å¤–éƒ¨ API é™æµè§„èŒƒ

> âš ï¸ **è¿åé™æµè§„åˆ™å¯èƒ½å¯¼è‡´ API è¢«æ°¸ä¹…å°ç¦ï¼**

| API | é™æµè§„åˆ™ | å®‰å…¨é—´éš” |
|---|---|---|
| **YGOProDeck** | 20 req/s | 300ms |
| **YGOCDB** | æ— æ˜ç¡®é™åˆ¶ | 300ms |
| **CDN å›¾æº** | å®½æ¾ | 300ms |

**å¿…é¡»éµå®ˆ**ï¼š
1. æ‰€æœ‰è¯·æ±‚ç»è¿‡å…¨å±€èŠ‚æµå™¨ `requestThrottler`ï¼ˆé—´éš” â‰¥ 300msï¼‰
2. ç¦æ­¢æ— é—´éš”å¾ªç¯è¯·æ±‚
3. æ–°å¢ API è°ƒç”¨ä½¿ç”¨ `requestThrottler.waitForNext()` æˆ–å·²æœ‰å°è£…å‡½æ•°
4. é‡åˆ° 403/429 æ‰§è¡Œé€€é¿é‡è¯•ï¼ˆ2s Ã— å°è¯•æ¬¡æ•°ï¼‰

## æœåŠ¡ç«¯ä»£ç†ï¼ˆCloudflare Pages Functionsï¼‰

| æ¥å£ | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| KONAMI å¡å›¾ä»£ç† | `/api/card-image?cid=<CID>` | ä»£ç† KONAMI å®˜ç½‘å¡å›¾ï¼ˆå½“å‰å›  WAF é™åˆ¶æ— æ³•è·å–çœŸå®å¡å›¾ï¼‰ |

æ–‡ä»¶ä½ç½®ï¼š`functions/api/card-image.js`

## å¡åŒ…å°é¢å›¾æ¥æºï¼ˆå¤šçº§ fallbackï¼‰

| ä¼˜å…ˆçº§ | æ¥æº |
|--------|------|
| 1 | `packs.json` ä¸­çš„ `coverImage` å­—æ®µï¼ˆæ‰‹åŠ¨é…ç½®ï¼‰ |
| 2 | `packs.json` ä¸­çš„ `coverCardId` â†’ å¯¹åº”å¡å›¾ |
| 3 | æœ¬åœ°å°é¢ `data/ocg/covers/{packCode}.png` |
| 4 | YGOProDeck set_imageï¼ˆTCG å¡åŒ…ï¼‰ |
| 5 | å¼‚æ­¥åŠ è½½ cardFile â†’ é¦–å¼ å¡çš„ CDN å¡å›¾ |
| 6 | emoji ğŸ´ï¼ˆå…œåº•ï¼‰ |

## å…³é”®æ•°æ®æ–‡ä»¶

| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| `js/currency.js` | è´§å¸ç³»ç»Ÿæ ¸å¿ƒæ¨¡å— |
| `js/inventory.js` | èƒŒåŒ…ç³»ç»Ÿæ ¸å¿ƒæ¨¡å— |
| `data/ocg/packs.json` | OCG å¡åŒ…å…ƒä¿¡æ¯ |
| `data/ocg/cards/*.json` | OCG å„å¡åŒ…ç‹¬ç«‹å¡ç‰Œåˆ—è¡¨ |
| `data/tcg/packs.json` | TCG å¡åŒ…é…ç½®è¡¨ |
| `data/tcg/yugiohmeta_map.json` | TCG å¡å›¾æ˜ å°„è¡¨ |
| `data/changelog.json` | æ›´æ–°æ—¥å¿—ï¼ˆç½‘é¡µå†…å±•ç¤ºï¼‰ |
| `data/fallback_cards.js` | ç¦»çº¿å…œåº•å¡ç‰Œæ•°æ® |
| `data/common/cards.json` | YGOCDB å…¨é‡æ•°æ®åº“ï¼ˆ12MBï¼Œ13900+ å¼ å¡ï¼‰ï¼Œé€šè¿‡ `update_cards_db.py` è‡ªåŠ¨æ›´æ–° |
| `data/common/rarities.json` | å…¨å±€ç¨€æœ‰åº¦å®šä¹‰æ–‡ä»¶ï¼Œç®¡ç†æ‰€æœ‰ç¨€æœ‰åº¦å…ƒæ•°æ®ï¼ˆåç§°/æè¿°/é¢œè‰²/åˆ†ç±»ç­‰ï¼‰ |

### OCG å¡åŒ…æ•°æ®ç›®å½•ç»“æ„

```
data/ocg/
â”œâ”€â”€ packs.json           â† å¡åŒ…å…ƒä¿¡æ¯ç´¢å¼•
â”œâ”€â”€ pack_list.json       â† å®Œæ•´å¡åŒ…ç›®å½•
â”œâ”€â”€ covers/              â† æœ¬åœ°å°é¢å›¾ï¼ˆ{packCode}.pngï¼‰
â””â”€â”€ cards/               â† ç‹¬ç«‹å¡ç‰Œåˆ—è¡¨æ–‡ä»¶
    â”œâ”€â”€ ocg_blzd.json
    â”œâ”€â”€ ocg_ch02.json
    â””â”€â”€ ocg_25db.json
```

### KONAMI å®˜æ–¹å•†å“å‚è€ƒæ•°æ®

```
pack_references/konami_official_products/
â”œâ”€â”€ basic_packs.json       â† åŸºæœ¬å¡åŒ…ï¼ˆ16 ä¸ªï¼‰
â”œâ”€â”€ structure_decks.json   â† é¢„ç»„å¡ç»„ï¼ˆ16 ä¸ªï¼‰
â”œâ”€â”€ concept_packs.json     â† æ¦‚å¿µå¡åŒ…ï¼ˆ16 ä¸ªï¼‰
â””â”€â”€ special_packs.json     â† ç‰¹æ®Šå¡åŒ…ï¼ˆ16 ä¸ªï¼‰
```

æ•°æ®æºï¼šhttps://www.yugioh-card.com/japan/products/ï¼ˆé‡‡é›†æ—¥æœŸ 2026-02-27ï¼‰