<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>YGO Pack Opener - 游戏王卡包开封模拟器</title>
<link rel="stylesheet" href="css/style.css?v=1.5.1">
</head>
<body>
    <!-- ====== 全局加载遮罩层 ====== -->
    <div id="loading-overlay" class="loading-overlay" style="display:none;">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p class="loading-text">加载中...</p>
        </div>
    </div>

    <!-- ====== 顶部导航栏 ====== -->
    <header class="top-bar">
        <!-- 货币显示栏 -->
        <div class="currency-bar">
            <div class="currency-item" id="currency-item-gold" title="点击兑换">
                <span class="currency-icon">🪙</span>
                <span class="currency-value" id="currency-balance-gold">0</span>
            </div>
            <div class="currency-item" id="currency-item-diamond" title="点击兑换">
                <span class="currency-icon">💎</span>
                <span class="currency-value" id="currency-balance-diamond">0</span>
            </div>
        </div>
        <!-- OCG / TCG 模式切换开关（TCG 默认隐藏，可在开发者工具中开启） -->
        <div class="mode-switch-container" id="mode-switch-container">
            <button id="btn-mode-ocg" class="mode-btn active" data-mode="ocg">OCG</button>
            <button id="btn-mode-tcg" class="mode-btn" data-mode="tcg" style="display:none;">TCG</button>
        </div>
        <nav class="top-nav">
            <button id="btn-inventory" class="nav-btn inventory-btn">🎒<span id="inventory-badge" class="inventory-badge" style="display:none;">0</span></button>
            <button id="btn-cache-manage" class="nav-btn">💾</button>
            <button id="btn-dev-tools" class="nav-btn dev-btn">🔧</button>
        </nav>
    </header>

    <!-- ====== 主游戏区域 ====== -->
    <main class="game-area">
        <!-- 卡包选择区域 -->
        <section id="pack-select-section" class="section-panel">
            <h2 class="section-title">选择卡包</h2>
            <!-- 卡包分类选项卡 -->
            <div id="pack-category-tabs" class="pack-category-tabs">
                <button class="pack-category-tab active" data-category="booster">补充包</button>
                <button class="pack-category-tab" data-category="structure">主题卡组</button>
                <button class="pack-category-tab" data-category="concept">系列补充包</button>
                <button class="pack-category-tab" data-category="special">特殊包</button>
            </div>
            <div id="pack-list" class="pack-list">
                <!-- 卡包列表会由 JS 动态生成 -->
            </div>
        </section>

        <!-- 开包按钮区域 -->
        <section id="open-pack-section" class="section-panel" style="display:none;">
            <div class="pack-info">
                <h2 id="current-pack-name" class="section-title"></h2>
                <div class="pack-cover-wrapper">
                    <button id="btn-pack-preview" class="btn-pack-preview" title="收藏预览">🔍</button>
                    <img id="current-pack-cover" class="pack-cover-large" src="" alt="卡包封面"
                         referrerpolicy="no-referrer" />
                </div>
                <p id="current-pack-desc" class="pack-desc"></p>
            </div>
            <div class="open-btn-container">
                <button id="btn-open-pack" class="btn-open-pack">开1包</button>
                <button id="btn-open-box" class="btn-open-box">开1盒<span class="btn-box-sub">赠送 +1 辅助包</span></button>
                <button id="btn-back-to-packs" class="btn-secondary">← 返回选择卡包</button>
            </div>
        </section>

        <!-- 开包动画遮罩层 -->
        <div id="opening-overlay" class="opening-overlay" style="display:none;">
            <div class="opening-animation">
                <div class="pack-tear">
                    <div class="pack-visual">🎴</div>
                    <p class="opening-text">正在开启卡包...</p>
                </div>
            </div>
        </div>

        <!-- 卡牌结果展示区域 -->
        <section id="result-section" class="section-panel" style="display:none;">
            <h2 class="section-title">开包结果</h2>
            <!-- 稀有度统计 -->
            <div id="rarity-stats" class="rarity-stats"></div>
            <!-- +1辅助包展示区域（仅开盒时显示） -->
            <div id="bonus-display" class="bonus-display" style="display:none;">
                <h3 class="bonus-display__title">+1 辅助包</h3>
                <div id="bonus-cards" class="bonus-display__cards"></div>
            </div>
            <div id="cards-display" class="cards-display">
                <!-- 抽到的卡牌会由 JS 动态生成 -->
            </div>
            <div class="result-actions">
                <button id="btn-open-again" class="btn-open-pack">再开1包</button>
                <button id="btn-open-again-box" class="btn-open-box">再开1盒<span class="btn-box-sub">赠送 +1 辅助包</span></button>
                <button id="btn-back-from-result" class="btn-secondary">← 返回选择卡包</button>
            </div>
        </section>
    </main>

    <!-- ====== 更新日志弹窗 ====== -->
    <div id="changelog-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>📋 更新日志</h2>
                <button id="btn-close-changelog" class="modal-close" onclick="document.getElementById('changelog-modal').classList.remove('active')">&times;</button>
            </div>
            <div id="changelog-content" class="modal-body">
                <!-- 更新日志内容由 JS 动态生成 -->
            </div>
        </div>
    </div>

    <!-- ====== 缓存管理弹窗 ====== -->
    <div id="cache-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>💾 缓存管理</h2>
                <button id="btn-close-cache" class="modal-close" onclick="document.getElementById('cache-modal').classList.remove('active')">&times;</button>
            </div>
            <div id="cache-content" class="modal-body">
                <!-- 缓存信息由 JS 动态生成 -->
            </div>
            <div class="modal-footer">
                <button id="btn-clear-cache" class="btn-danger">🗑️ 清除所有缓存</button>
            </div>
        </div>
    </div>

    <!-- ====== 开发者工具：CDN 卡图对比面板 ====== -->
    <div id="devtools-modal" class="modal-overlay">
        <div class="modal-content devtools-modal-content">
            <div class="modal-header">
                <h2>🔧 开发者工具</h2>
                <button id="btn-close-devtools" class="modal-close">&times;</button>
            </div>
            <div class="modal-body devtools-body">
                <!-- ▸ 板块一：快捷操作 -->
                <div class="devtools-section-card">
                    <h3 class="devtools-section-title">🛠️ 快捷操作</h3>
                    <div class="devtools-actions-btns">
                        <button id="btn-dev-add-gold" class="btn-devtools-action btn-dev-gold">🪙 添加 10000 金币</button>
                        <button id="btn-dev-reset-game" class="btn-devtools-action btn-dev-reset">🔄 重置游戏</button>
                    </div>
                    <p class="devtools-note">💡 重置游戏：仅重置货币余额，不清除缓存。若需清除缓存，请前往「💾 缓存管理」。</p>
                </div>

                <!-- ▸ 板块：TCG 测试模式 -->
                <div class="devtools-section-card">
                    <h3 class="devtools-section-title">🌎 TCG 测试模式</h3>
                    <div class="devtools-actions-btns">
                        <button id="btn-dev-toggle-tcg" class="btn-devtools-action btn-dev-tcg">🔓 开启 TCG 模式</button>
                    </div>
                    <p class="devtools-note devtools-tcg-warning">⚠️ TCG 开发未完成，仅为测试版本。开启后可在顶部切换到 TCG 模式，数据和功能可能不完整。</p>
                </div>

                <!-- ▸ 板块二：CDN 卡图对比 -->
                <div class="devtools-section-card">
                    <h3 class="devtools-section-title">🖼️ CDN 卡图对比</h3>
                    <!-- 当前模式信息（优先展示，让用户知道当前上下文） -->
                    <div id="devtools-mode-info" class="devtools-mode-info"></div>
                    <!-- 卡片ID输入区 -->
                    <div class="devtools-input-area">
                        <label for="devtools-card-id">卡片ID：</label>
                        <input type="text" id="devtools-card-id" placeholder="例如 89631139（青眼白龙）" />
                    </div>
                    <div class="devtools-input-actions">
                        <button id="btn-devtools-load" class="btn-devtools-action">🔍 加载对比</button>
                        <button id="btn-devtools-random" class="btn-devtools-action btn-devtools-random">🎲 随机卡片</button>
                    </div>
                    <!-- CDN 对比结果区 -->
                    <div id="devtools-compare-area" class="devtools-compare-area">
                        <p class="devtools-placeholder">输入卡片 ID 后点击「加载对比」，或使用「🎲 随机卡片」来测试</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ====== 卡片预览弹窗 ====== -->
    <div id="card-preview-modal" class="modal-overlay">
        <div class="modal-content card-preview-modal-content">
            <div class="modal-header">
                <h2 id="card-preview-title">🔍 卡片预览</h2>
                <button id="btn-close-card-preview" class="modal-close">&times;</button>
            </div>
            <div id="card-preview-content" class="modal-body">
                <!-- 卡片预览内容由 JS 动态生成 -->
            </div>
        </div>
    </div>

    <!-- ====== 背包弹窗 ====== -->
    <div id="inventory-modal" class="modal-overlay">
        <div class="modal-content inventory-modal-content">
            <div class="modal-header">
                <h2>🎒 我的背包</h2>
                <button id="btn-close-inventory" class="modal-close">&times;</button>
            </div>
            <div id="inventory-content" class="modal-body">
                <!-- 背包内容由 JS 动态生成 -->
            </div>
        </div>
    </div>

    <!-- ====== 货币兑换弹窗 ====== -->
    <div id="exchange-modal" class="modal-overlay">
        <div class="modal-content exchange-modal-content">
            <div class="modal-header">
                <h2>💱 货币兑换</h2>
                <button id="btn-close-exchange" class="modal-close">&times;</button>
            </div>
            <div id="exchange-content" class="modal-body">
                <!-- 兑换内容由 JS 动态生成 -->
            </div>
        </div>
    </div>

    <!-- ====== 卡牌图片放大查看器 ====== -->
    <div id="card-image-viewer" class="card-image-viewer">
        <span class="viewer-hint">点击任意位置关闭</span>
        <img class="viewer-image" src="" alt="卡牌大图">
        <div class="viewer-card-name"></div>
    </div>

    <!-- ====== 页脚 ====== -->
    <footer class="footer">
<p><span id="footer-version" class="footer-version-link" title="点击查看更新日志">YGO Pack Opener v1.5.1</span> | 游戏王卡包开封模拟器</p>
        <p class="footer-credit">
            外文数据: <a href="https://ygoprodeck.com/" target="_blank" rel="noopener">YGOProDeck</a> | 
            中文名称: <a href="https://ygocdb.com/" target="_blank" rel="noopener">YGOCDB</a> | 
            Yu-Gi-Oh! © <a href="https://www.konami.com/" target="_blank" rel="noopener">Konami</a>
        </p>
    </footer>

    <!-- 内联脚本：确保弹窗关闭按钮始终可用（不受外部JS缓存影响） -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // 通用弹窗关闭逻辑
        document.querySelectorAll('.modal-close').forEach(function(btn) {
            btn.addEventListener('click', function() {
                var modal = this.closest('.modal-overlay');
                if (modal) modal.classList.remove('active');
            });
        });
        // 点击弹窗遮罩层（外部区域）也能关闭
        document.querySelectorAll('.modal-overlay').forEach(function(overlay) {
            overlay.addEventListener('click', function(e) {
                if (e.target === this) this.classList.remove('active');
            });
        });
    });
    </script>

    <!-- 先加载离线备用数据，再加载 API 模块，最后加载游戏逻辑 -->
    <script src="data/fallback_cards.js?v=1.5.1"></script>
    <script src="js/currency.js?v=1.5.1"></script>
    <script src="js/inventory.js?v=1.5.1"></script>
    <script src="js/api.js?v=1.5.1"></script>
    <script src="js/game.js?v=1.5.1"></script>
</body>
</html>
